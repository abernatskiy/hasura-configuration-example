# Hasura-based squid

This is an example squid that uses a dedicated Hasura instance to serve GraphQL.

Requirements: NodeJS v20 or newer, Git, Docker

## Preparing the squid

```bash
git clone https://github.com/subsquid-labs/squid-hasura-example
cd squid-hasura-example
npm ci
npm run build
```

## Running the squid

```bash
docker compose up -d
sqd run . -m manifests/local.yml
```
You can now visit the [Hasura console](http://localhost:8080/console), login with the admin password `testing` and observe the entities and relationships in the GraphiQL playground. Alternatively, just run the following test query at [http://localhost:8080/v1/graphql](http://localhost:8080/v1/graphql):
```graphql
query {
  burn(limit: 10) {
    id
    value
    address
  }
}
```

## About the configuration

Each Hasura configuration file `hasura/config` corresponds to one call to [Hasura API](https://hasura.io/docs/latest/api-reference/overview/). This autogenerated configuration tracks all tables in the database schema defined by TypeORM models (`src/models`) and gives the `public` role the permission to read all columns in these tables.

Regenerate the configuration with
```bash
npx squid-hasura-configuration regenerate
```

Apply it with
```bash
npx squid-hasura-configuration apply
```

Feel free to add any extra configuration calls.

### Required environment variables

Hasura container and the configuration tool use the following variables:

- `HASURA_GRAPHQL_ADMIN_SECRET` must be defined - either via `.env` (for local runs) or via [SQD Cloud secrets](https://docs.sqd.dev/cloud/resources/env-variables/#secrets) (see `manifests/cloud.yml`)
- `HASURA_GRAPHQL_UNAUTHORIZED_ROLE` must be defined and set to `public`. If you change the role name, update `.env`, all manifests and [regenerate the Hasura config](#automatic-configuration).
